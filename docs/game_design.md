# 修仙文字MUD游戏设计文档

## 📋 项目概述

**项目名称**: 修仙文字MUD（xiuxian-wuxia）
**项目类型**: 中国古典仙侠文化文字MUD游戏
**设计目标**: 1年以上长期运营，稳定成长曲线，有考据的数值平衡

---

## 🎮 核心设计理念

### 游戏定位

- **类型**: 文字MUD（Multi-User Dungeon）
- **平台**: Web端（支持浏览器访问）
- **玩法**: 放置挂机修炼（打坐）、任务、探索、PVP
- **目标玩家**: 修仙爱好者，喜欢长期放置和成长

### 核心特色

1. **🎭 丰富的修仙段位**
   - 炼气期（1-99）→筑基期（100-199）→金丹期（200-299）→元婴期（300-499）→元神期（500-999）
   - 每个阶段都有独特的修炼方式和能力

2. **📊 考据数值体系**
   - 基于修仙境界的能力值系统
   - 五大门派属性加成
   - 装备品质系统
   - 完善的数值平衡

3. **🎯 稳定成长曲线**
   - 指数级增长（炼气期）
   - 对数级增长（金丹期开始）
   - 避免后期爆级，保证长期可玩性

4. **💰 仙石经济系统**
   - 平衡的产出和消耗
   - 支持交易、拍卖、商店

5. **🌍 秘境探索**
   - 不同的秘境区域（洞窟、森林、城市、BOSS副本）
   - 稀有掉落和BOSS挑战

6. **⚔️ 门派战争和秘境**
   - 门派贡献系统
   - 大型活动和副本

7. **📚 完善的考据机制**
   - 战斗力评估
   - 门派声望影响
   - 装备品质影响战斗力

---

## 🏗️ 架构设计

### 技术栈

#### 后端
- **语言**: Python 3.10+
- **框架**: 
  - Web框架: Flask或FastAPI
  - 游戏循环: asyncio
  - 数据库: PostgreSQL或SQLite
  - 缓存: Redis（可选）

#### 前端
- **界面**: 命令行（CLI）+ 文本MUD界面
- **样式**: ASCII艺术 + ANSI颜色
- **终端**: 支持256色

#### 数据库设计
```
表：玩家（players）、装备（items）、怪物（monsters）、任务（quests）、交易（transactions）
关系：玩家装备、任务记录、交易历史
索引：player_id（唯一）、item_id（唯一）、怪等级、门派类型
```

### 系统架构

```
┌─────────────────────────────┐
│   CLI / MUD Interface      │
│      Game Logic Layer           │
│      Data Access Layer           │
└─────────────────────────────┘
└──────────────────────────────────┘
         Database / Storage
```

- **CLI/MUD Interface**: 处理用户输入、显示、命令解析
- **Game Logic**: 游戏核心逻辑（战斗、修炼、经济）
- **Data Access**: 数据库操作、文件读写
- **Database**: PostgreSQL存储游戏数据

---

## 📊 数据模型设计

### 核心数据类

#### 1. 玩家类
```python
@dataclass
class Player:
    player_id: str          # 唯一ID
    name: str              # 角色名
    level: int             # 当前等级（1-999）
    xp: int               # 经验值
    stage: CultivationStage  # 修仙境界
    sect: SectType          # 门派
    cultivation: int        # 修为值
    sect_stats: Dict      # 门派属性加成
    base_stats: Dict      # 基础五维属性
    spirit_stones: int    # 仙石数量
    equipment: List[str]   # 装备列表
    current_map: str       # 当前地图
    talents: List[str]    # 已学习的技能
    created_at: datetime   # 创建时间
    last_active: datetime  # 最后活跃时间
```

#### 2. 门派类
```python
@dataclass
class Sect:
    sect_id: str          # 门派ID
    name: str              # 门派名称
    type: SectType        # 门派类型
    description: str       # 门派描述
    cultivation: int        # 门派修为
    title: str            # 掌门称号
    color: str           # 门派代表色（UI）
```

#### 3. 装备类
```python
@dataclass
class Item:
    item_id: str          # 装备ID
    name: str              # 装备名称
    type: str             # 类型：weapon/armor/accessory/artifact/pill/skillbook
    quality: ItemQuality    # 品质
    stat_bonuses: Dict    # 属性加成
    description: str       # 描述
    base_value: int       # 基础属性值
    price: int            # 仙石价格
```

#### 4. 怪物类
```python
@dataclass
class Monster:
    monster_id: str        # 怪物ID
    name: str              # 怪物名称
    level: int             # 等级
    stage: CultivationStage  # 对应的修仙阶段
    sect: SectType          # 所属门派
    hp: int                # 当前HP
    max_hp: int            # 最大HP
    attack: int            # 攻击力
    defense: int           # 防御力
    experience: int         # 经验值
    drop_rate: float       # 掉落率
    drops: List[str]      # 掉落物品ID
```

#### 5. 修仙境界枚举
```python
class CultivationStage(Enum):
    QI = "炼气期"          # 等级1-99
    ZHUJI = "筑基期"         # 等级100-199
    JINDAN = "金丹期"        # 等级200-299
    YUANYING = "元婴期"    # 等级300-499
    YUANSHEN = "元神期"    # 等级500-999
```

#### 6. 门派类型枚举
```python
class SectType(Enum):
    QINGYUN = "青云门"     # 青云门
    DANDING = "丹鼎门"     # 丹鼎门
    WANHUA = "万花谷"     # 万花谷
    XIAOYAO = "逍遥宗"    # 逍遥宗
    SHUSHAN = "蜀山派"     # 蜀山派
```

#### 7. 装备品质枚举
```python
class ItemQuality(Enum):
    COMMON = "下品"         # 基础装备，+5-10属性
    RARE = "中品"           # 灵力装备，+11-20属性
    EPIC = "上品"           # 仙器装备，+21-40属性
    LEGENDARY = "极品"        # 极品装备，+41-80属性
    ARTIFACT = "法宝"      # 传说级法宝，+100+属性
```

#### 8. 属性类型
```python
class StatType(Enum):
    ATTACK = "攻击力"
    DEFENSE = "防御力"
    SPEED = "速度"
    AGILITY = "敏捷"
    CONSTITUTION = "体质"
    INTELLECT = "智力"
```

---

## 🎮 游戏核心系统

### 1. 修仙境界系统

#### 炼气期（Level 1-99）
- **修炼方式**: 打坐吸收天地灵气
- **时间消耗**: 1小时游戏时间 = 1个月修为
- **经验获取**: 10点/小时
- **突破条件**: 积累1000点经验值
- **能力提升**:
  - 灵压上限 +10%
  - 气血防御 +5%
  - 行动速度 +10%
- **经验阈值**:
  - 1级 → 1000点
  - 50级 → 50000点
  - 99级 → 100000点

#### 筑基期（Level 100-199）
- **修炼方式**: 炼化真气，凝练金身
- **时间消耗**: 1小时游戏时间 = 2个月修为
- **经验获取**: 20点/小时
- **突破条件**: 积累10000点经验值
- **能力提升**:
  - 真气上限 +20%
  - 法术攻击 +10%
  - 法术防御 +10%
  - 内视能力 +5%
- **经验阈值**:
  - 100级 → 10000点
  - 199级 → 200000点

#### 金丹期（Level 200-299）
- **修炼方式**: 服用金丹，淬炼金身
- **时间消耗**: 1小时游戏时间 = 3个月修为
- **经验获取**: 50点/小时
- **突破条件**: 积累100000点经验值
- **能力提升**:
  - 金丹效果 +30%
  - 火属性抗性 +15%
  - 寿命上限 +10%
- **经验阈值**:
  - 200级 → 100000点
  - 299级 → 500000点

#### 元婴期（Level 300-499）
- **修炼方式**: 破丹结婴，渡雷劫
- **时间消耗**: 1小时游戏时间 = 4个月修为
- **经验获取**: 100点/小时
- **突破条件**: 积累1000000点经验值
- **能力提升**:
  - 元婴出窍 +30%
  - 妖法护盾 +10%
  - 通天法术 +20%
  - 渡劫成功率 +20%
- **经验阈值**:
  - 300级 → 1000000点
  - 499级 → 10000000点

#### 元神期（Level 500-999）
- **修炼方式**: 元神归位，飞升仙界
- **时间消耗**: 1小时游戏时间 = 6个月修为
- **经验获取**: 500点/小时
- **突破条件**: 积累10000000点经验值
- **能力提升**:
  - 神之力 +50%
  - 通天法术 +20%
  - 仙身不死 +10%
  - 天道法则 +30%
- **经验阈值**:
  - 500级 → 10000000点
  - 999级 → 100000000点

---

## ⚔️ 战斗系统设计

### 战斗属性

- **五维属性**: 攻击力、防御力、速度、敏捷、体质、智力
- **计算公式**: 战斗力 = (攻击 * 速度 + 敏捷 * 智力) / 5 + 装备加成
- **门派克制**: 影响战斗力的 +/- 20%

### 战斗流程

1. **战斗判定**:
   - 防御力 > 攻击力：高防御流（难杀死）
   - 攻击力 > 防御力：高攻击流（容易被杀）
   - 属性相克：克制 x 1.5 倍，被克 x 0.5 倍

2. **命中计算**:
   - 基础命中率: 90%
   - 敏捷修正: 敏捷 / (目标敏捷 + 速度) * 0.5%
   - 最终命中率 = 基础命中率 + 敏捷修正

3. **暴击系统**:
   - 基础暴击率: 10%
   - 暴击修正: 基础暴击率 + 武器品质加成
   - 武器品质加成: 下品+0%, 中品+2%, 上品+5%, 极品+10%, 法宝+20%
   - 最终暴击率 = min(30%, 基础暴击率 + 暴击修正)

4. **伤害计算**:
   - 基础伤害 = 攻击力 - 防御力
   - 修正后伤害 = max(1, 基础伤害)
   - 门派克制修正: 修正后伤害 * 克制倍率
   - 技能加成: 根据技能效果
   - 最终伤害 = 修正后伤害 * (1 + 技能加成)
   - 暴击伤害 = 最终伤害 * (1.5 或 2.0)

---

## 💰 经济系统设计

### 仙石获取

#### 获取方式
| 方式 | 产出 | 时间 | 说明 |
|------|------|------|------|
| 打坐 | 10-20 | 1小时 | 吸收天地灵气 |
| 任务完成 | 50-2000 | 不定期 | 门派任务、秘境探索 |
| 交易 | 买卖 | - | 玩家交易 |
| 门派福利 | 100-5000 | 每日 | 门派每日福利 |

#### 仙石消耗
| 消耗类型 | 消耗量 | 说明 |
|------|--------|------|
| 修炼 | 10-50 | 1小时 | 打坐、修炼消耗 |
| 传送 | 100-5000 | - | 跨地图传送 |
| 战斗复活 | 5000-20000 | - | 死亡损失仙石 |
| 购买装备 | 物品价格 | - | 一次性 |
| 学习技能 | 100-10000 | - | 学习门派功法 |

#### 经济平衡
- **日产出**: 120-240仙石（打坐 + 任务 + 门派福利）
- **日消耗**: 60-150仙石（修炼 + 传送）
- **净收益**: 60-90仙石/天
- **成长曲线**: 需要3-6个月积累才能购买高级装备

---

## 🏔️ 门派系统

### 五大门派

#### 1. 青云门（QINGYUN）
- **特色**: 速度、闪避、逍遥自在
- **属性加成**: 速度+20%, 敏捷+15%, 闪避+10%
- **门派技能**:
  - 青云剑法：攻击+30%, 速度+20%
  - 清风诀：净化负面
  - 流云步法：飞行

#### 2. 丹鼎门（DANDING）
- **特色**: 防御、火属性、炼丹
- **属性加成**: 防御+25%, 生命+20%, 火抗+15%
- **门派技能**:
  - 金鼎诀：提升丹药效果50%
  - 炼丹术：炼气效率+40%
  - 九鼎炼术：提升装备全属性+10%

#### 3. 万花谷（WANHUA）
- **特色**: 治疗、炼药、抗毒
- **属性加成**: 生命+30%, 治愈+25%, 抗毒+20%
- **门派技能**:
  - 万花医术：瞬间恢复30%生命
  - 炼金散：提升属性
  - 回春术：减少复活损失

#### 4. 逍遥宗（XIAOYAO）
- **特色**: 闪避、隐身、轻功
- **属性加成**: 闪避+25%, 暴击+10%, 移动-50%
- **门派技能**:
  - 逍遥步：闪避50%
  - 无相功法：隐身2回合
  - 逍遥心法：减少消耗30%

#### 5. 蜀山派（SHUSHAN）
- **特色**: 武力、坚韧、破甲
- **属性加成**: 攻击+30%, 防御+20%, 暴击+15%
- **门派技能**:
  - 蜀山剑法：攻击+40%, 破甲+25%
  - 八卦掌法：全属性+15%
  - 金刚伏魔功：免疫伤害, 反伤20%

---

## 🌍 秘境系统

### 秘境类型

| 秘境 | 等级 | BOSS | 特色 |
|------|------|------|
| 炼气洞 | 30-60 | 无 | 资源收集 |
| 妖兽林 | 60-90 | 无 | 野兽袭击 |
| 鼠市 | 90-120 | 有 | NPC交易 |
| 鬼鬼池 | 120-180 | 是 | 强力BOSS |
| 秘境 | 180-250 | 是 | 终极秘境 |

### 秘境探索

- **单人探索**: 适合打坐、任务、独行
- **组队探索**: 适合秘境BOSS、大型副本
- **风险等级**:
  - 安全: 常规行走
  - 中等: 使用技能和装备
  - 高风险: 进入秘境、挑战BOSS

---

## 📚 装备系统

### 装备类型

1. **武器**: 剑、刀、枪、斧、扇
2. **护甲**: 布衣、皮甲、锁子甲、盔甲、护腿
3. **首饰**: 项链、戒指、腰带、手饰、头饰
4. **法宝**: 指环、宝珠、玉简、护身符
5. **丹药**: 修仙丹药、恢复药剂
6. **技能书**: 门派功法秘籍

### 装备品质

| 品质 | 属性加成 | 价格倍率 | 说明 |
|------|--------|--------|------|
| 下品 | +5-10 | 1x | 普通装备 |
| 中品 | +11-20 | 5x | 灵力装备 |
| 上品 | +21-40 | 20x | 仙器装备 |
| 极品 | +41-80 | 50x | 极品装备 |
| 法宝 | +100+200 | 100x | 传说级法宝 |

### 装备获取

- **商店购买**: 使用仙石购买
- **门派任务**: 完成门派任务获得
- **秘境掉落**: BOSS和精英怪掉落
- **交易**: 玩家间买卖
- **制作**: 玩家使用炼丹术制作

---

## 🎯 成长曲线

### 长期运营（1年以上）

#### 月度成长
```
新玩家 (Level 1-30):
  - 第1月: 1级 → 20级 (19级)
  - 第2月: 20级 → 40级 (20级)
  - 第3月: 40级 → 60级 (20级)
  - ...
  - 第12月: 200级 → 筑基期

中期玩家 (Level 31-150):
  - 第13-18月: 200级 → 250级 (50级)
  - 第19-30月: 250级 → 300级 (50级)
  - 第31-36月: 300级 → 350级 (50级)
  - ...
  - 第48个月: 350级 → 筑基期

后期玩家 (Level 151-300):
  - 第49-54月: 筑基期 → 300级 (50级)
  - 第55-60月: 300级 → 350级 (50级)
  - 第61-66月: 350级 → 400级 (50级)
  - ...
  - 第84-96月: 400级 → 450级 (50级)
  - 第97-108月: 450级 → 500级 (50级)
  - 第109-120月: 500级 → 金丹期 (50级)
```

#### 顶级玩家（Level 300-600）
```
第1-5年 (300-600级): 在巅峰期积累实力
- 参与门派大战、秘境BOSS挑战
- 争夺第一、第二、第三位排名
- 获得稀有法宝和称号
```

### 经验值曲线

```
Level 1-99 (炼气期): 经验 = 等级^2 (指数级)
Level 100-299 (筑基期): 经验 = 等级 * 10 (对数级)
Level 300-499 (元婴期): 经验 = 2^等级 (对数级)
Level 500-999 (元神期): 经验 = 2.5^等级 (对数级增长)
```

---

## 🔧 技术实现建议

### 开发语言
- **后端**: Python 3.10+
- **前端**: 命令行界面（Python CLI）
- **数据库**: SQLite（开发阶段）→ PostgreSQL（生产）

### 开发框架
- **后端**: Flask或FastAPI
- **异步**: asyncio
- **CLI**: Click或Typer

### 核心模块
1. **游戏循环**: 定时任务（打坐、修炼、战斗）
2. **数据访问**: SQLAlchemy ORM
3. **命令解析**: 命令解析器
4. **状态管理**: 玩家状态机
5. **数值计算**: 战斗力、经验、属性计算

---

## 📖 文件结构

### 推荐目录结构

```
~/code_work/xiuxian-wuxia/
├── src/                    # 源代码
│   ├── models/            # 数据模型
│   ├── game/            # 游戏逻辑
│   │   ├── combat.py   # 战斗系统
│   │   ├── cultivation.py # 修仙系统
│   │   ├── economy.py   # 经济系统
│   │   └── skills.py    # 门派技能
│   ├── cli/             # 命令行界面
│   │   ├── commands.py   # 命令解析
│   │   ├── display.py    # 界面显示
│   │   └── main.py       # 主入口
│   ├── data/             # 数据管理
│   │   ├── database.py   # 数据库操作
│   │   ├── storage.py    # 文件存储
│   │   └── config.py    # 配置管理
│   ├── tests/            # 测试
│   ├── docs/             # 文档
│   └── requirements.txt # 依赖
├── config/                 # 配置文件
│   ├── settings.yaml      # 游戏设置
│   ├── skills.yaml       # 门派技能配置
│   └── balance.yaml     # 数值平衡
├── scripts/               # 运行脚本
│   ├── init_db.py      # 初始化数据库
│   ├── run_server.py   # 启动游戏服务
│   └── test_server.py  # 测试服务
└── README.md             # 项目说明
```

---

## 🚀 开发里程碑

### 第一阶段：基础框架（1-2个月）
- [ ] 项目结构搭建
- [ ] 数据模型定义
- [ ] 基础CLI界面
- [ ] 数据库设计

### 第二阶段：核心系统（3-5个月）
- [ ] 修仙境界系统
- [ ] 门派系统
- [ ] 装备系统
- [ ] 战斗系统
- [ ] 经济系统

### 第三阶段：内容扩展（5-7个月）
- [ ] 秘境系统
- [ ] 任务系统
- [ ] NPC系统
- [ ] 故事系统
- [ ] 门派战争
- [ ] 社交系统

### 第四阶段：优化与完善（7-12个月）
- [ ] 性能优化
- [ ] 数值平衡调整
- [ ] 新内容更新
- [ ] 长期运营支持

---

## 🎯 下一步

### 第一批任务（发送给Opencode）

根据您的要求，这些是Opencode可以"安排"和执行的具体任务：

#### 任务1：分析修仙文字MUD游戏设计
```
请分析修仙文字MUD游戏（xiuxian-wuxia）的设计要求：

核心需求：
1. 修仙境界体系：炼气期（1-99）→筑基期（100-199）→金丹期（200-299）→元婴期（300-499）→元神期（500-999）
2. 五大门派系统：青雲、丹鼎、万花谷、逍遥宗、蜀山派，每个门派都有独特的功法和技能体系
3. 装备和法宝系统：下品、中品、上品、极品、法宝，每个品质都有属性加成
4. 仙石经济系统：修仙的基础货币，通过打坐、任务、交易获取
5. 秘境探索系统：不同的秘境区域，有强大的妖兽和宝物
6. 考据数值体系：基于修仙境界的能力值计算，门派声望影响
7. 战斗系统：五维属性，门派克制关系，暴击、闪避等
8. 成长系统：稳定的成长曲线，指数级和对数级增长，避免后期爆级
9. 长期运营：支撑1年以上持续发展
10. 数据结构：玩家、装备、怪物、任务、交易

技术实现：
- 数据结构：Player、Sect、Item、Monster、CultivationStage等
- 数值平衡：各境界、门派、装备的数值要平衡
- 接口设计：CLI命令解析、游戏循环、数据持久化
- 存储方式：SQLite数据库（开发阶段）→ PostgreSQL（生产）
- 用户界面：命令行界面，支持256色显示

请提供：
1. 完整的数据类定义（Python dataclasses）
2. 数据库Schema设计
3. 文件组织结构
4. 开发语言建议（Python）
5. 核心系统设计（境界、门派、装备、经济、战斗）
6. 数值平衡方案（经验公式、成长曲线、属性加成）
7. 用户界面设计（MUD界面、命令系统、地图显示）
8. 技术架构建议（Flask、asyncio、SQLAlchemy）
9. 经济平衡方案（仙石产出、消耗、交易）
10. 长期运营支持（内容更新、活动系统）
```

---

## 💡 总结

这个设计文档提供了：
- ✅ **完整的游戏设计**
- ✅ **数据模型定义**
- ✅ **核心系统说明**
- ✅ **数值平衡方案**
- ✅ **技术架构建议**
- ✅ **开发里程碑规划**

现在Opencode可以根据这些设计文档进行代码实现。

---

需要我帮您：
1. 发送这个任务给Opencode？
2. 继续下一个任务（星图游戏）？
3. 或者等待Opencode的反馈？

您的选择是：**直接发送任务**（选项1）？
